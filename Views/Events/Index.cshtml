@model EventsViewModel

@{
    ViewBag.Title = "Events";
}

<div class="fancyLeft text-left">
    
    @{
        var now = DateTimeOffset.Now;
        var initialCountDown = Model.Current.Starting - new DateTimeOffset(now.Year, now.Month, now.Day, now.Hour, now.Minute, now.Second, TimeSpan.FromHours(2));
    }

    <h1 id="tabTitle">Next Event In:</h1>
    <h2 style="margin-top: 10px" id="next-event-countdown">@( $"{initialCountDown:c}" ) </h2>
</div>

<div class="fancyRight text-right">
    <h1>@Model.Current.Name</h1>
    <h2>@Model.Current.WeekDay, @Model.Current.Time GMT</h2>
</div>

<img alt="War of Rights Event Schedule" src="@Url.Content("~/img/during-the-american-civil-war.jpg")" class="imageMaxWidth">

<p></p>

<div id="calendar">
    <div id="monthsDisplay" class="fancyLeft">
        @await Html.PartialAsync("_Month", model: new EventsViewModel()
        {
            EventTemplates = Model.ScheduledEvents,
            Current = new Event()
            {
                Starting = now.AddMonths(-1)
            }
        })

        @await Html.PartialAsync("_Month", model: new EventsViewModel()
        {
            EventTemplates = Model.ScheduledEvents,
            Current = new Event()
            {
                Starting = now
            }
        })

        @await Html.PartialAsync("_Month", model: new EventsViewModel()
        {
            EventTemplates = Model.ScheduledEvents,
            Current = new Event()
            {
                Starting = now.AddMonths(1)
            }
        })

    </div>
    


    <div id="eventTemplates" class="fancyRight">
        @foreach(var e in Model.EventTemplates)
        {
            <h2>@e.Name</h2>
            <h3>

                @if (e.Occurring == EventOccurrence.OnlyOnce)
                {
                    @e.Starting
                }
                else
                {
                    @:@e.WeekDay, @e.Time - @e.Occurring.ToString()
                }
            </h3>
            
            <p class="text-center">@e.Description</p>
        }
    </div>
</div>

@section scripts {
    <script src="lib/moment.js/moment-with-locales.min.js"></script>

    <script>


        /*$(document).ready(function () {

            var track = 0;
            function timeNow() {

                var now = new Date,
                    hours = now.getHours(),
                    /*ampm    = hours<12 ? ' AM' : ' PM',#1#
                    minutes = now.getMinutes(),
                    seconds = now.getSeconds(),
                    t_str = [(hours < 10 ? "0" + hours : hours),
                            (minutes < 10 ? "0" + minutes : minutes),
                            (seconds < 10 ? "0" + seconds : seconds)]
                        .join(':');

                document.getElementById("current-time").innerHTML = t_str;
                track += 1;
            }

            window.TimeTrack = function () {
                return track;
            };

            window.TimeTick = setInterval(function () {
                timeNow();
            }, 1000);


        });*/
    </script>
}
